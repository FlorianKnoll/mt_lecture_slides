\tikzsetnextfilename{mr_spatial_encoding_net_magnetization}
\begin{tikzpicture}[scale=0.5]
	\draw[white] (-4, -1) rectangle (20, 1);
	\draw (-1, 0) node {$\sum$};
	\draw (-2, 0) node {$=$};
	\draw[ultra thick,->] (-3, -0.4) -- (-3,0.4);
	\pgfmathsetmacro{\angle}{0}
	\foreach \idx in {0,1,...,19} {
		\draw ($(\idx,0)-(0.5,0.5)$) rectangle ($(\idx,0)+(0.5,0.5)$);
		\pgfmathsetmacro{\anglevalue}{90+\idx*\angle}
		\pgfmathsetmacro{\magn}{0.125*(cos(\idx*360/20) + 1)+0.075}
		\pgfmathsetmacro{\x}{\idx+\magn*cos(\anglevalue)}
		\pgfmathsetmacro{\a}{\idx-\magn*cos(\anglevalue)}
		\pgfmathsetmacro{\y}{\magn*sin(\anglevalue)}
		\pgfmathsetmacro{\b}{-\magn*sin(\anglevalue)}
		\draw[thick,<-] (\x, \y) -- (\a, \b);
	}
	\draw[very thick,decoration={brace, mirror},decorate] (-0.4, -0.7) -- (19.4, -0.7);
	\draw[->,thick] (-3, -0.7) to[out=270,in=180] (-2.25, -1.75) node [right,font=\small] {net magnetization $= \sum$ magnetizations within voxels};
\end{tikzpicture}